{{- if .install_packages -}}

{{- if eq .chezmoi.os "windows" }}

echo "Installing or upgrading neovim"

# Refresh path
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","User"),[System.Environment]::GetEnvironmentVariable("Path","Machine") -join ";"

$IsElevated = 'true' -eq (gsudo status IsElevated)

if ($IsElevated -eq $false) {
  Write-Warning "This script requires local admin privileges. Elevating..."
  gsudo "& '$($MyInvocation.MyCommand.Source)'" $args
  if ($LastExitCode -eq 999 ) {
    Write-error 'Failed to elevate.'
  }
  return
}

{{ if .install_nvim -}}
echo "Installing or upgrading neovim"
choco upgrade neovim -y
echo "Finished installing or upgrading neovim"
{{- end -}}

{{ if .install_nvim -}}
echo "Installing vim-plug for neovim"
# Install vim-plug for neovim
iwr -useb https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim |`
    ni "$(@($env:XDG_DATA_HOME, $env:LOCALAPPDATA)[$null -eq $env:XDG_DATA_HOME])/nvim-data/site/autoload/plug.vim" -Force
echo "Finished installing vim-plug"
# end install_nvim
{{- end -}}

# end of windows
{{- end -}}

# end of install_packages
{{- end -}}

