{{- if .install_packages -}}

{{- if eq .chezmoi.os "windows" }}

# Refresh path
# https://stackoverflow.com/questions/41305457/powershell-refresh-env-path-for-the-active-session?noredirect=1&lq=1
# https://stackoverflow.com/questions/714877/setting-windows-powershell-environment-variables
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","User"),[System.Environment]::GetEnvironmentVariable("Path","Machine") -join ";"

# Install Powershell 7 modules
echo "Installing powershell modules posh-git, PSFzf, oh-my-posh"
Set-ExecutionPolicy Bypass -Scope Process -Force;
$pwsh_path = "C:\Program Files\PowerShell\7\pwsh.exe"
& "$pwsh_path" -c 'Install-Module -Name posh-git -Confirm:$False -Force'
& "$pwsh_path" -c 'Install-Module -Name PSFzf -Confirm:$False -Force'
& "$pwsh_path" -c 'Invoke-Expression ((New-Object System.Net.WebClient).DownloadString(''https://ohmyposh.dev/install.ps1''))'

echo "Installing oh my posh font meslo"
& "$pwsh_path" -c 'oh-my-posh font install meslo'

echo "Finished installing powershell modules"

# end of windows
{{- end -}}

# end of install_packages
{{- end -}}

